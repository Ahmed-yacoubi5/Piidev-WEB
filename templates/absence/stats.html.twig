{% extends 'baseBack.html.twig' %}

{% block title %}Absence Statistics Dashboard{% endblock %}

{% block body %}
    <!-- Content wrapper -->
    <div class="content-wrapper">
        <!-- Content -->
        <div class="container-xxl flex-grow-1 container-p-y">
            <div class="row">
                <div class="col-lg-12 mb-4">
                    <div class="card">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="card-header">
                                <h4 class="card-title mb-0">
                                    <i class="bx bx-stats"></i> Absence Statistics Dashboard
                                </h4>
                                <small class="text-muted">Comprehensive analysis of employee absence patterns</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- Total Absences Card -->
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <div class="avatar flex-shrink-0 mx-auto mb-3">
                                <span class="avatar-initial rounded bg-label-primary">
                                    <i class="bx bx-calendar"></i>
                                </span>
                            </div>
                            <h3 class="card-title mb-2">{{ total }}</h3>
                            <span class="fw-semibold d-block mb-1">Total Absences</span>
                            <small class="text-success fw-semibold">
                                <i class="bx bx-trending-up"></i>
                                Overview of all absence requests
                            </small>
                        </div>
                    </div>
                </div>

                <!-- By Status Card -->
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header d-flex align-items-center justify-content-between">
                            <h5 class="card-title m-0 me-2">
                                <i class="bx bx-list-check"></i> By Status
                            </h5>
                            <div class="dropdown">
                                <button class="btn p-0" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="bx bx-dots-vertical-rounded"></i>
                                </button>
                                <div class="dropdown-menu dropdown-menu-end">
                                    <a class="dropdown-item" href="javascript:void(0);">View Details</a>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive text-nowrap">
                                <table class="table table-borderless">
                                    <tbody>
                                        {% for stat in byStatut %}
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <span class="badge badge-dot me-2 
                                                        {% if stat.statut == 'Approved' %}bg-success
                                                        {% elseif stat.statut == 'Pending' %}bg-warning
                                                        {% elseif stat.statut == 'Rejected' %}bg-danger
                                                        {% else %}bg-secondary
                                                        {% endif %}"></span>
                                                    <span>{{ stat.statut }}</span>
                                                </div>
                                            </td>
                                            <td class="text-end">
                                                <span class="fw-semibold">{{ stat.count }}</span>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- By Type Card -->
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header d-flex align-items-center justify-content-between">
                            <h5 class="card-title m-0 me-2">
                                <i class="bx bx-category"></i> By Type
                            </h5>
                            <div class="dropdown">
                                <button class="btn p-0" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="bx bx-dots-vertical-rounded"></i>
                                </button>
                                <div class="dropdown-menu dropdown-menu-end">
                                    <a class="dropdown-item" href="javascript:void(0);">View Details</a>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive text-nowrap">
                                <table class="table table-borderless">
                                    <tbody>
                                        {% for type in byType %}
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <span class="badge badge-dot bg-primary me-2"></span>
                                                    <span>{{ type.type }}</span>
                                                </div>
                                            </td>
                                            <td class="text-end">
                                                <span class="fw-semibold">{{ type.count }}</span>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            
        </div>
        <!-- / Content -->

        <!-- Footer -->
        <footer class="content-footer footer bg-footer-theme">
            <div class="container-xxl d-flex flex-wrap justify-content-between py-2 flex-md-row flex-column">
                <div class="mb-2 mb-md-0">
                    ©
                    <script>
                        document.write(new Date().getFullYear());
                    </script>
                    , made with ❤️ by Your Company
                </div>
            </div>
        </footer>
        <!-- / Footer -->

        <div class="content-backdrop fade"></div>
    </div>
    <!-- Content wrapper -->

    <style>
        .card {
            border-radius: 0.5rem;
            box-shadow: 0 2px 6px 0 rgba(67, 89, 113, 0.12);
            transition: all 0.3s ease;
        }
        .card:hover {
            box-shadow: 0 8px 16px 0 rgba(67, 89, 113, 0.16);
            transform: translateY(-2px);
        }
        .avatar-initial {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        .badge-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }
        .table-borderless tbody tr:last-child td {
            border-bottom: none;
        }
    </style>

    <!-- Add these scripts at the end of your body or in your base template -->
    <script src="../assets/vendor/libs/apex-charts/apexcharts.js"></script>
    <script>
        // Monthly Trends Chart
        document.addEventListener('DOMContentLoaded', function() {
            const monthlyTrendsChartEl = document.querySelector('#monthlyTrendsChart');
            if (monthlyTrendsChartEl) {
                const monthlyTrendsChart = new ApexCharts(monthlyTrendsChartEl, {
                    series: [{
                        name: 'Absences',
                        data: [28, 32, 35, 40, 36, 32, 30, 25, 28, 32, 38, 42]
                    }],
                    chart: {
                        height: 300,
                        type: 'area',
                        toolbar: {
                            show: false
                        }
                    },
                    colors: ['#696cff'],
                    dataLabels: {
                        enabled: false
                    },
                    stroke: {
                        curve: 'smooth',
                        width: 2
                    },
                    xaxis: {
                        categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
                    },
                    tooltip: {
                        y: {
                            formatter: function(val) {
                                return val + " absences";
                            }
                        }
                    },
                    fill: {
                        type: 'gradient',
                        gradient: {
                            shadeIntensity: 1,
                            opacityFrom: 0.7,
                            opacityTo: 0.1,
                            stops: [0, 90, 100]
                        }
                    }
                });
                monthlyTrendsChart.render();
            }
        });
    </script>
{% endblock %}